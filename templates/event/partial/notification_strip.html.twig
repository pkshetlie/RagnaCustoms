{% if notification is defined and notification %}
  {% set nowTs = "now"|date('U') %}
  {% set startTs = notification.startAt is not null ? notification.startAt|date('U') : null %}
  {% set endTs = notification.endAt is not null ? notification.endAt|date('U') : null %}
  {% if (startTs is null or startTs <= nowTs) and (endTs is null or endTs >= nowTs) %}
    <div id="notification-strip-{{ notification.id }}" class="w-100 text-larger bg-info" role="status" aria-live="polite" aria-atomic="true">
      <div class="container d-flex text-center align-items-center justify-content-between py-2">
        <div class="flex-grow-1 me-3">
          {% if notification.link %}
            <a href="{{ notification.link }}" class="text-white text-decoration-none notif-message">{{ notification.message|raw }}</a>
          {% else %}
            <div class="notif-message">{{ notification.message|raw }}</div>
          {% endif %}
        </div>

        <button type="button"
                class="btn btn-info p-0 ms-3 notif-dismiss"
                aria-label="Dismiss"
                data-notif-id="{{ notification.id }}">
          <span aria-hidden="true">âœ•</span>
        </button>
      </div>
    </div>

    <script>
    (function(){
      const id = "{{ notification.id }}";
      const key = 'dismiss_notification_' + id;
      try {
        if (localStorage.getItem(key)) {
          document.getElementById('notification-strip-' + id)?.remove();
          return;
        }
      } catch(e) {}

      document.querySelectorAll('#notification-strip-{{ notification.id }} .notif-dismiss').forEach(btn => {
        btn.addEventListener('click', function(){
          const strip = document.getElementById('notification-strip-{{ notification.id }}');
          if (strip) strip.remove();
          try { localStorage.setItem(key, '1'); } catch(e) {}
        });
      });
    })();
    </script>
  {% endif %}
{% endif %}